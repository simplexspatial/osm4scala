<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<script src="gitter_conf.js"></script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer="defer"></script><title data-react-helmet="true">Spark SQL Connector | osm4scala</title><meta data-react-helmet="true" property="og:url" content="https://simplexspatial.github.io/osm4scala//osm4scala/docs/spark-connector"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spark SQL Connector | osm4scala"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="shortcut icon" href="/osm4scala/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://simplexspatial.github.io/osm4scala//osm4scala/docs/spark-connector"><link data-react-helmet="true" rel="alternate" href="https://simplexspatial.github.io/osm4scala//osm4scala/docs/spark-connector" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://simplexspatial.github.io/osm4scala//osm4scala/docs/spark-connector" hreflang="x-default"><link rel="stylesheet" href="/osm4scala/assets/css/styles.03c1686d.css">
<link rel="preload" href="/osm4scala/assets/js/styles.f80c1d3e.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/runtime~main.00840857.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/main.37fafecd.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/common.c6f076c5.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/2.93cd78ec.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/13.b1270c54.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/14.309c5716.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/935f2afb.f8ab1ee9.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/17896441.8deed969.js" as="script">
<link rel="preload" href="/osm4scala/assets/js/54a74294.c7ef556a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/osm4scala/"><img src="/osm4scala/img/logo.svg" alt="osm4scala logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/osm4scala/img/logo.svg" alt="osm4scala logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">osm4scala</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/osm4scala/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/simplexspatial/osm4scala" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/osm4scala/"><img src="/osm4scala/img/logo.svg" alt="osm4scala logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/osm4scala/img/logo.svg" alt="osm4scala logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">osm4scala</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/osm4scala/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/simplexspatial/osm4scala" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/osm4scala/docs/">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/osm4scala/docs/spark-connector">Spark SQL Connector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/osm4scala/docs/standalone-scala-library">Scala library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/osm4scala/docs/performance">Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/osm4scala/docs/contributing">Contributing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Spark SQL Connector</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>Using <em>Osm4scala Spark SQL Connector</em>, reading OSM Pbf file from <strong>PySpark</strong>, <strong>Spark Scala</strong>, <strong>SparkSQL</strong> or <strong>SparkR</strong> is
so easy as writing <code>.read.format(&quot;osm.pbf&quot;)</code>.</p><p>The current implementation offers:</p><ul><li>Spark 2 and 3 versions, with Scala 2.11 and 2.12</li><li>Full Spark SQL integration.</li><li>Easy schema.</li><li>Internal optimizations, like:<ul><li>Transparent parallelism reading multiply pbf files.</li><li>File splitting to increase parallelism per pbf file.</li><li>Pushdown required columns.</li></ul></li></ul><p>The library is distributed via <a href="https://mvnrepository.com/artifact/com.acervera.osm4scala" target="_blank" rel="noopener noreferrer">Maven Repo</a> in two different flavours:</p><ul><li><a href="#all-in-one-jar">All in one jar</a> to be able to use directly with all dependencies</li><li>As <a href="#plain-non-shaded-jar-dependency">plain scala dependency</a>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="schema-definition"></a>Schema definition<a class="hash-link" href="#schema-definition" title="Direct link to heading">#</a></h2><p>The Dataframe Schema used is the following one:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- id: long (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- type: byte (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- latitude: double (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- longitude: double (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- nodes: array (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- element: long (containsNull = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- relations: array (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- element: struct (containsNull = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |    |-- id: long (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |    |-- relationType: byte (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |    |-- role: string (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- tags: map (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- key: string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- value: string (valueContainsNull = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |-- info: struct (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- version: integer (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- timestamp: timestamp (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- changeset: long (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- userId: integer (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- userName: string (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |    |-- visible: boolean (nullable = true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Where the column <code>type</code> could be:</p><table><thead><tr><th align="center">value</th><th align="center">meaning</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">Node</td></tr><tr><td align="center">1</td><td align="center">Way</td></tr><tr><td align="center">2</td><td align="center">Relation</td></tr></tbody></table><p>Where the column <code>relationType</code> could be:</p><table><thead><tr><th align="center">value</th><th align="center">meaning</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">Node</td></tr><tr><td align="center">1</td><td align="center">Way</td></tr><tr><td align="center">2</td><td align="center">Relation</td></tr><tr><td align="center">3</td><td align="center">Unrecognized</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="all-in-one-jar"></a>All in one jar<a class="hash-link" href="#all-in-one-jar" title="Direct link to heading">#</a></h2><p>Usually, osm4scala is used from the <a href="#spark-shell">Spark Shell</a> or from a <a href="#notebook">Notebook</a>. For these cases,
to simplify the way to add the connector as dependency, you have a shaded fat jar version with all dependencies that are
necessary.
The fat jar is near 5MB, so the size should be not a problem.</p><p>As you probably know, Spark is base in Scala. Different Spark distributions are using different Scala versions.
This is the Spark/Scala version combination available for latest release v1.0.8:</p><table><thead><tr><th align="center">Spark Branch</th><th align="center">Scala</th><th align="left">Packages</th></tr></thead><tbody><tr><td align="center">2.4</td><td align="center">2.11</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark2-shaded_2.11/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark2-shaded_2.11:1.0.8</code></a></td></tr><tr><td align="center">2.4</td><td align="center">2.12</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark2-shaded_2.12/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark2-shaded_2.12:1.0.8</code></a></td></tr><tr><td align="center">3.0 / 3.1</td><td align="center">2.12</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark3-shaded_2.12/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8</code></a></td></tr></tbody></table><p>Although following sections are focus on Spark Shell and Notebooks, you can use the same technique in other situations where
you want to use the shaded version.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-a-fat-shaded-library"></a>Why a fat shaded library?<a class="hash-link" href="#why-a-fat-shaded-library" title="Direct link to heading">#</a></h3><p>Osm4scala has a transitive dependency with Java Google Protobuf library. Spark, Hadoop and other libraries in the
ecosystem are using an old version of the same library (currently v2.5.0 from Mar, 2013) that is not compatible.</p><p>To solve the conflict, I published the library in two fashion:</p><ul><li>Fat and Shaded as <code>osm4scala-spark[2,3]-shaded</code> that solves <code>com.google.protobuf.**</code> conflicts.</li><li>Don&#x27;t shaded as <code>osm4scala-spark[2,3]</code>, so you can solve the conflict on your way.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spark-shell"></a>Spark Shell<a class="hash-link" href="#spark-shell" title="Direct link to heading">#</a></h3><ol><li><p>Start the spark shell as usual, using the <code>--package</code> option to add the right dependency. The dependency will depend to
the Spark Version that you are using. Please, check the reference table in the previous section.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/spark-shell --packages </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/pyspark --packages &#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">SQL</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/spark-sql --packages &#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Create the Dataframe using the osm.pbf format, pointing to the pbf file or folder containing pbf files.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; val osmDF = spark.read.format(&quot;osm.pbf&quot;).load(&quot;&lt;osm files path here&gt;&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark</div><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> osmDF </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;osm.pbf&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;osm files path here&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">SQL</div><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">sql</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> osm </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> osm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">pbf LOCATION </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;osm files path here&gt;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Use the created dataframe as usual, keeping in mind the schema explained previously.</p><ul><li><p>In the next example, we are going to count the number of different primitives in
the file. As explained in the schema, 0 are nodes, 1 ways and 2 relations.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; osmDF.groupBy(&quot;type&quot;).count().show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|type|   count|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   1| 2096455|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   2|   91971|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   0|19426617|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark</div><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> osmDF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">groupBy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token builtin" style="color:rgb(130, 170, 255)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">   count</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2096455</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">91971</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">19426617</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">SQL</div><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">sql</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> osm </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">338795</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">10357</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">2328075</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>In this other examples, we are going to extract all traffic lights as POIs.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; osmDF.select(&quot;latitude&quot;, &quot;longitude&quot;, &quot;tags&quot;).where(&quot;element_at(tags, &#x27;highway&#x27;) == &#x27;traffic_signals&#x27;&quot;).show(10,false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+-------------------+------------------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|latitude          |longitude          |tags                                                                          |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+-------------------+------------------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|54.59766649999997 |-5.8889806000000045|[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|54.58006689999997 |-5.938683200000003 |[highway -&gt; traffic_signals, traffic_signals -&gt; signal]                       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|54.58260049999997 |-5.946187600000005 |[direction -&gt; backward, highway -&gt; traffic_signals, traffic_signals -&gt; signal]|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.90097769999996 |-8.470285700000005 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.901616299999965|-8.470139700000004 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.89978239999997 |-8.465829200000002 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.89707529999997 |-8.474892800000001 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.89784849999997 |-8.466895200000002 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.89547809999997 |-8.476100900000002 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|51.89772569999997 |-8.477145100000003 |[highway -&gt; traffic_signals]                                                  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+-------------------+------------------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 10 rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark</div><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> osmDF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;latitude&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;longitude&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tags&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">where</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;element_at(tags, &#x27;highway&#x27;) == &#x27;traffic_signals&#x27;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">latitude          </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">longitude          </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">tags                                                                          </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">54.59766649999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">5.8889806000000045</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">54.58006689999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">5.938683200000003</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> traffic_signals </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> signal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                       </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">54.58260049999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">5.946187600000005</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">direction </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> backward</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> traffic_signals </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> signal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.90097769999996</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.470285700000005</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.901616299999965</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.470139700000004</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.89978239999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.465829200000002</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.89707529999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.474892800000001</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.89784849999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.466895200000002</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.89547809999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.476100900000002</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">51.89772569999997</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">8.477145100000003</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">highway </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> traffic_signals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">SQL</div><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">sql</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> latitude</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> longitude</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tags </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> osm </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> element_at</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;traffic_signals&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">limit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.42125</span><span class="token plain">            </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.6844500000000004</span><span class="token plain"> {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;crossing&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;crossing_ref&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;zebra&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.41779000000001</span><span class="token plain">   </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.6241199999999996</span><span class="token plain"> {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.41473000000003</span><span class="token plain">   </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.627109999999999</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.414200000000015</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.6282099999999993</span><span class="token plain"> {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.42635999999994</span><span class="token plain">   </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.727220000000005</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;crossing&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.41937999999995</span><span class="token plain">   </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.688820000000004</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.426489999999944</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.687640000000004</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;signal&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.421339999999944</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.683020000000004</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.41797999999994</span><span class="token plain">   </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.669340000000004</span><span class="token plain">  {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">40.418319999999945</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">3.6762200000000043</span><span class="token plain"> {</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;highway&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;traffic_signals&quot;</span><span class="token plain">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;signal&quot;</span><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">Time</span><span class="token plain"> taken: </span><span class="token number" style="color:rgb(247, 140, 108)">0.128</span><span class="token plain"> seconds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Fetched </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="notebook"></a>Notebook<a class="hash-link" href="#notebook" title="Direct link to heading">#</a></h3><p>There are different notebooks solutions in the market and each one is using a different way to import libraries. But after
importing the library, you can use the osm4scala connector in the same way.</p><p>For this section, we are going to use <a href="https://jupyter.org" target="_blank" rel="noopener noreferrer">Jupyter Notebook</a> and <a href="https://jupyterlab.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">JupyterLab</a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you can not access to a Jupyter Notebook
installation, you can use <a href="https://hub.docker.com/r/jupyter/all-spark-notebook" target="_blank" rel="noopener noreferrer">jupyter/all-spark-notebook</a> Docker image as I will do.
<a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Here</a>, full documentation about how to install and use it.</p><p>To start the docker image, as easy as running the docker image and use the link provided:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ssh"><div tabindex="0" class="prism-code language-ssh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -e JUPYTER_ENABLE_LAB=yes -d -p 8888:8888 -p 4040:4040 -p 4041:4041 jupyter/all-spark-notebook</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[I 11:02:45.132 NotebookApp] Serving notebooks from local directory: /home/jovyan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[I 11:02:45.132 NotebookApp] Jupyter Notebook 6.2.0 is running at:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[I 11:02:45.132 NotebookApp] http://479a92a85698:8888/?token=60ace2db5d456f7348c2ba0399cab986e36f4de9XX00a554</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[I 11:02:45.132 NotebookApp]  or http://127.0.0.1:8888/?token=60ace2db5d456f7348c2ba0399cab986e36f4de9XX00a554</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[I 11:02:45.132 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[C 11:02:45.135 NotebookApp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    To access the notebook, open this file in a browser:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        file:///home/jovyan/.local/share/jupyter/runtime/nbserver-6-open.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Or copy and paste one of these URLs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        http://479a92a85698:8888/?token=60ace2db5d456f7348c2ba0399cab986e36f4de9XX00a554</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     or http://127.0.0.1:8888/?token=60ace2db5d456f7348c2ba0399cab986e36f4de9XX00a554</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you prefer an online option, you can try <a href="https://mybinder.org/v2/gh/jupyter/docker-stacks/master?filepath=README.ipynb" target="_blank" rel="noopener noreferrer">MyBinder</a>.</p></div></div><ol><li><p>Create a new Notebook. For Scala, we are going to use the <code>spylon-kernel</code>.</p></li><li><p>Add a new Cell and import the right osm4scala library for your Notebook installation, following the table at the start
of the <a href="#all-in-one-jar">All in one jar</a> section. In or case, the version used is <code>Spark v3.1.1</code> with <code>Scala 2.12</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jypiter"><div tabindex="0" class="prism-code language-jypiter codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">%%init_spark</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">launcher.packages = [&quot;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you did not execute anything before, running the cell will start the Spark session. Sometime, depending to the
Notebook used, <strong>you will need to restart the Spark session (or Kernel session)</strong>.</p></li><li><p>From the previous step, you can start creating dataframes from pbf files as we did before in previous sections.</p><p>Let&#x27;s suppose that you uploaded a file called <code>monaco-anonymized.osm.pbf</code> into the notebook&#x27;s <code>work</code> folder.</p><p>If you create a new Cell with next content, you will get all traffic signals in Monaco.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val osmDF = spark.read.format(&quot;osm.pbf&quot;).load(&quot;/home/jovyan/work/monaco-anonymized.osm.pbf&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">osmDF.select(&quot;latitude&quot;, &quot;longitude&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .where(&quot;element_at(tags, &#x27;highway&#x27;) == &#x27;traffic_signals&#x27;&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .show</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain">python</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">osm_df </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;osm.pbf&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/home/jovyan/work/monaco-anonymized.osm.pbf&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">osm_df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;latitude&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;longitude&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">where</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;element_at(tags, &#x27;highway&#x27;) == &#x27;traffic_signals&#x27;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Pay attention to the first line in the Python Cell. Because the kernel used is using <code>Scala</code> as default, you need to add
the <strong><code>%%python</code></strong> header.</p></div></div><p>Next, a screenshot with the output generated:
<img alt="Notebook Screenshoot" src="/osm4scala/assets/images/notebook_screenshoot-9fb4d00eb90d069d41a895f8bf170b1f.png"></p><p>Of course, from the dataframe you can create beautiful maps, graphs, etc. But that is out of the scope of this documentation.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spark-application"></a>Spark application<a class="hash-link" href="#spark-application" title="Direct link to heading">#</a></h3><p>When we need to write more complex analysis, data extractions, ETLs, etc, it is necessary to write Spark applications.</p><ol><li><p>Import the spark connector <strong>it is not really necessary</strong> because the integration is transparent.</p><p>Only two <em>possible</em> advantages (not available if using Python) are:</p><ul><li><p>The use of static constants, for example, to avoid <code>magic numbers</code> for primitive and relation types.</p></li><li><p>Using the library as part of Unit Testing or Integration Testing.</p></li><li><p>Adding osm4scala jar library as part of the deployable artifact.</p><p><strong>For Python</strong>, like in Scala, it is not necessary to import the library except in runtime. But unlike in Scala, you
can not <em>easily</em> to import and use facilities from the Scala library. So in this case, you can jump to the next step.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Sbt</div><div class="codeBlockContent_hGly sbt"><div tabindex="0" class="prism-code language-sbt codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">libraryDependencies += &quot;com.acervera.osm4scala&quot; % &quot;osm4scala-spark3-shaded_2.12&quot; % &quot;1.0.8&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Maven</div><div class="codeBlockContent_hGly xml"><div tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.acervera.osm4scala</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">osm4scala-spark3-shaded_2.12</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">1.0.8</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Reduce artifact size.</h5></div><div class="admonition-content"><p>The shaded dependency is near 5MB. You can add this dependency as a package when you submit the job instead to include it
in the deployable artifact generated. To do it, set the scope dependency as <code>Test</code> or <code>Provided</code>.</p><p><em>If you don&#x27;t know what I&#x27;m talking about, don&#x27;t pay too much attention and forget it.</em> ðŸ˜‰</p></div></div></li></ul></li><li><p>Create the Dataframe using the osm.pbf format, pointing to the pbf file or folder containing pbf files, and use as usual.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala / PrimitivesCounter.scala</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import com.acervera.osm4scala.spark.OsmSqlEntity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import org.apache.spark.sql.SparkSession</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">object PrimitivesCounter {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def main(args: Array[String]): Unit = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val spark = SparkSession</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .builder()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .appName(&quot;Primitives counter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .getOrCreate()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spark.read</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .format(&quot;osm.pbf&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .load(args(0))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .groupBy(OsmSqlEntity.FIELD_TYPE)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      .show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark / PrimiriveCounter.py</div><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sql </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SparkSession</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> sys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spark </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">builder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Primitives counter&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">getOrCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;osm.pbf&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">groupBy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Submit the application to your Spark cluster.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Scala</div><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/spark-submit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --packages </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    examples/spark-documentation/target/scala-2.12/osm4scala-examples-spark-documentation_2.12-1.0.8-SNAPSHOT.jar </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /tmp/osm/monaco-anonymized.osm.pbf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">PySpark</div><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bin/spark-submit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --packages </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    examples/spark-documentation/src/main/scala/com/acervera/osm4scala/examples/spark/documentation/PrimiriveCounter.py </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /tmp/osm/monaco-anonymized.osm.pbf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Optional --packages.</h5></div><div class="admonition-content"><p>You will not need to add <code>--packages &#x27;com.acervera.osm4scala:osm4scala-spark3-shaded_2.12:1.0.8&#x27;</code> if it is part of the
deployed artifact.</p></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="more-examples"></a>More Examples<a class="hash-link" href="#more-examples" title="Direct link to heading">#</a></h3><p>Following, more examples. This time, we will create a SQL temporal view and SQL:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; val osmDF = spark.sqlContext.read.format(&quot;osm.pbf&quot;).load(&quot;&lt;osm files path here&gt;&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">osmDF: org.apache.spark.sql.DataFrame = [id: bigint, type: tinyint ... 5 more fields]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; osmDF.createOrReplaceTempView(&quot;osm&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Primitives counter</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select type, count(*) as num_primitives from osm group by type&quot;).show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|type|num_primitives|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   1|        338795|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   2|         10357|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   0|       2328075|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----+--------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Extract all keys used in tags</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select distinct(explode(map_keys(tags))) as tag_key from osm order by tag_key asc&quot;).show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|           tag_key|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|             Calle|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        Conference|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|             Exper|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|             FIXME|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|         ISO3166-1|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  ISO3166-1:alpha2|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  ISO3166-1:alpha3|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| ISO3166-1:numeric|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|         ISO3166-2|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|           MAC_dec|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|            Nombre|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|            Numero|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|              Open|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        Peluqueria|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    Residencia UEM|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|          Telefono|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|         abandoned|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| abandoned:amenity|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| abandoned:barrier|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|abandoned:building|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 20 rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Extract id, coords and tags from all nodes</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select id, latitude, longitude, tags from osm where type = 0&quot;).show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+--------+------------------+-------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|      id|          latitude|          longitude|                tags|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+--------+------------------+-------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171933|          40.42006|-3.7016600000000004|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171946|          40.42125|-3.6844500000000004|[highway -&gt; traff...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171948|40.420230000000004|-3.6877900000000006|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171951|40.417350000000006|-3.6889800000000004|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171952|          40.41499|-3.6889800000000004|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171953|          40.41277|-3.6889000000000003|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171954|          40.40946|-3.6887900000000005|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  171959|          40.40326|-3.7012200000000006|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952874|          40.42099|-3.6019200000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952875|40.422610000000006|-3.5994900000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952878| 40.42136000000001| -3.601470000000001|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952879| 40.42262000000001| -3.599770000000001|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952881| 40.42905000000001|-3.5970500000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952883| 40.43131000000001|-3.5961000000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952888| 40.42930000000001| -3.596590000000001|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952890| 40.43012000000001|-3.5961500000000006|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952891| 40.43043000000001|-3.5963600000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952892| 40.43057000000001|-3.5969100000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952893| 40.43039000000001|-3.5973200000000007|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|20952895| 40.42967000000001|-3.5972300000000006|                  []|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+--------+------------------+-------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 20 rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Extract id, nodes and tags from all ways</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select id, nodes, tags from osm where type = 1&quot;).show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-------+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|     id|               nodes|                tags|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-------+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996189|[23002322, 230022...|[name -&gt; M-40, in...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996190|[20952892, 213645...|[name -&gt; Avenida ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996191|[21364526, 253693...|[lanes -&gt; 2, onew...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996192|[20952914, 242495...|[name -&gt; Plaza de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996195|[20952923, 421448...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996196|[20952942, 209529...|[name -&gt; Avenida ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996197|[20952893, 209628...|[name -&gt; Avenida ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996199|[20952929, 209529...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3996203|[20952948, 391553...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997425|[20960686, 219912...|[name -&gt; Avenida ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997426|[2424952617, 2095...|[name -&gt; Avenida ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997427|[20960717, 209606...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997428|[20960693, 209607...|[highway -&gt; terti...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997429|[20960696, 421448...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997430|[20963025, 209630...|[name -&gt; Paseo de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997432|[20960688, 209607...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|3997433|[1811010970, 1811...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|4004278|[255148257, 21067...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|4004280|[20963101, 209630...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|4004281|[25530614, 297977...|[name -&gt; Calle de...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-------+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 20 rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Extract id, relations and tags from all relations</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select id, relations, tags from osm where type = 2&quot;).show()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-----+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   id|           relations|                tags|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-----+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|11331|[[2609596233, 0, ...|[network -&gt; Cerca...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|11332|[[196618381, 1, p...|[network -&gt; Cerca...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|14612|[[24698019, 1, ou...|[website -&gt; http:...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|30117|[[26629303, 1, ou...|[type -&gt; multipol...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|30399|[[307006515, 1, i...|[website -&gt; http:...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|38757|[[6120746, 1, ], ...|[network -&gt; lcn, ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|38965|[[44571128, 1, fr...|[type -&gt; restrict...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|48292|[[317775809, 0, s...|[network -&gt; Metro...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|49958|[[308868559, 0, v...|[type -&gt; restrict...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|49959|[[308868558, 0, v...|[type -&gt; restrict...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|50874|[[26141446, 1, ou...|[name -&gt; Escuela ...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|52312|[[24531942, 1, ou...|[name -&gt; Pista pr...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|52313|[[24698560, 1, ou...|[type -&gt; multipol...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|53157|[[2609596077, 0, ...|[network -&gt; Cerca...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|55085|[[246285922, 0, s...|[network -&gt; Cerca...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|55087|[[194005015, 1, ]...|[network -&gt; Cerca...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|55799|[[28775036, 1, ou...|[type -&gt; multipol...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|56044|[[258556530, 0, s...|[network -&gt; Metro...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|56260|[[144383571, 1, o...|[name -&gt; Ayuntami...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|56791|[[32218973, 0, st...|[network -&gt; Metro...|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-----+--------------------+--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 20 rows</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Extract id, relations and tags from all relations</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">scala&gt; spark.sql(&quot;select id, type, info.version, info.userId, info.userName, date_format(info.timestamp, \&quot;dd-MMM-y kk:mm:ss z\&quot;) as timestamp from osm where info.userId IS NOT NULL&quot;).show(5, false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+----+-------+--------+------------+------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|id       |type|version|userId  |userName    |timestamp               |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+----+-------+--------+------------+------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|10966459 |2   |26     |18XXXX  |XXXXX       |01-Oct-2020 18:44:49 IST|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|166399497|1   |4      |16XXXXX |XXXXXXXXXXXX|09-Aug-2019 05:52:21 IST|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|434583789|1   |7      |25XXXX  |XXXXXX      |05-Mar-2020 06:48:01 IST|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|161752645|1   |14     |11XXXXXX|XXXXXXXXXXX |22-Mar-2021 09:08:10 IST|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|690021772|1   |1      |31XXXX  |XXXXX       |14-May-2019 19:18:06 IST|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---------+----+-------+--------+------------+------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">only showing top 5 rows</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="plain-non-shaded-jar-dependency"></a>Plain (non-shaded jar) dependency.<a class="hash-link" href="#plain-non-shaded-jar-dependency" title="Direct link to heading">#</a></h2><p>Sometimes we need to write more complex applications, analysis, data extractions, ETLs, integrate with other libraries,
unit testing, etc.
In that case, the best practice is to manage dependencies using <code>sbt</code> or <code>maven</code>, instead to import the shaded file.</p><p>OSM Pbf files are based on <a href="https://developers.google.com/protocol-buffers" target="_blank" rel="noopener noreferrer">Protocol Buffer</a>, so <a href="https://scalapb.github.io" target="_blank" rel="noopener noreferrer">Scalapb</a> is
used as deserializer so it&#x27;s the unique transitive dependency.</p><p>This is the Spark/Scala version combination available for latest release v1.0.8:</p><table><thead><tr><th align="center">Spark branch</th><th align="center">Scalapb</th><th align="center">Scala</th><th align="left">Packages</th></tr></thead><tbody><tr><td align="center">2.4</td><td align="center">0.9.7</td><td align="center">2.11</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark2_2.11/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark2_2.11:1.0.8</code></a></td></tr><tr><td align="center">2.4</td><td align="center">0.10.2</td><td align="center">2.12</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark2_2.12/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark2_2.12:1.0.8</code></a></td></tr><tr><td align="center">3.0 / 3.1</td><td align="center">0.10.2</td><td align="center">2.12</td><td align="left"><a href="https://search.maven.org/artifact/com.acervera.osm4scala/osm4scala-spark3_2.12/1.0.8/jar" target="_blank" rel="noopener noreferrer"><code>com.acervera.osm4scala:osm4scala-spark3_2.12:1.0.8</code></a></td></tr></tbody></table><p>After importing the connector, you can use it as we explained in the <a href="#all-in-one-jar">All in one section</a>. So lets see
how to import the library in our project and few examples.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolving-dependency-conflicts"></a>Resolving dependency conflicts<a class="hash-link" href="#resolving-dependency-conflicts" title="Direct link to heading">#</a></h3><p>Osm4scala has a transitive dependency with Java Google Protobuf library.
Spark, Hadoop and other libraries in the ecosystem are using an older version of the same library (currently v2.5.0 from Mar, 2013) that is not compatible.</p><p>To be able to resolve this conflicts, you will need to <code>shade</code> your deployed jar. The conflict comes from the package <code>com.google.protobuf</code>.</p><p>Following, how to do it using SBT:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Sbt</div><div class="codeBlockContent_hGly scala"><div tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">assemblyShadeRules in assembly := Seq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ShadeRule</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .rename(&quot;com.google.protobuf.**&quot; -&gt; &quot;shadeproto.@1&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  .inAll</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It is possible to do the same using the <a href="https://maven.apache.org/plugins/maven-shade-plugin/index.html" target="_blank" rel="noopener noreferrer">shade maven plugin</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/simplexspatial/osm4scala/edit/master/website/docs/spark-connector.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/osm4scala/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/osm4scala/docs/standalone-scala-library"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scala library Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#schema-definition" class="table-of-contents__link">Schema definition</a></li><li><a href="#all-in-one-jar" class="table-of-contents__link">All in one jar</a><ul><li><a href="#why-a-fat-shaded-library" class="table-of-contents__link">Why a fat shaded library?</a></li><li><a href="#spark-shell" class="table-of-contents__link">Spark Shell</a></li><li><a href="#notebook" class="table-of-contents__link">Notebook</a></li><li><a href="#spark-application" class="table-of-contents__link">Spark application</a></li><li><a href="#more-examples" class="table-of-contents__link">More Examples</a></li></ul></li><li><a href="#plain-non-shaded-jar-dependency" class="table-of-contents__link">Plain (non-shaded jar) dependency.</a><ul><li><a href="#resolving-dependency-conflicts" class="table-of-contents__link">Resolving dependency conflicts</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/osm4scala/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/search?q=osm4scala" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/osm4scala/talk" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/simplexspatial/osm4scala" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.acervera.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About the author</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 <a href="https://www.acervera.com/" target="_blank">Ãngel Cervera Claudio</a>. Supported by Simplexportal Ltd.</div></div></div></footer></div>
<script src="/osm4scala/assets/js/styles.f80c1d3e.js"></script>
<script src="/osm4scala/assets/js/runtime~main.00840857.js"></script>
<script src="/osm4scala/assets/js/main.37fafecd.js"></script>
<script src="/osm4scala/assets/js/common.c6f076c5.js"></script>
<script src="/osm4scala/assets/js/2.93cd78ec.js"></script>
<script src="/osm4scala/assets/js/13.b1270c54.js"></script>
<script src="/osm4scala/assets/js/14.309c5716.js"></script>
<script src="/osm4scala/assets/js/935f2afb.f8ab1ee9.js"></script>
<script src="/osm4scala/assets/js/17896441.8deed969.js"></script>
<script src="/osm4scala/assets/js/54a74294.c7ef556a.js"></script>
</body>
</html>